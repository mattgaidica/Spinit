<div class="row-fluid">
  <div class="span8">
    <div class="well"><iframe height="298px;" width="100%" src="http://www.youtube.com/embed/RpOHZc6cDIw" frameborder="0" allowfullscreen></iframe></div>
  </div>
  <div class="span4">
    <div style="height:323px;padding:9px 0;" class="well sidebar-nav">
      <ul class="nav nav-list">
        <li style="text-align:center;margin:10px;" class="nav-header">Announcement</li>
        <li><span class="message">Test</span></li>
        <li><span class="message">Test</span></li>
        <li><span class="message">Test</span></li>
        <li><span class="message">Test</span></li>
        <li><span class="message">Test</span></li>
      </ul>
    </div><!--/.well -->
  </div>
</div>
<div class="row-fluid">
  <div class="span2">
    <center>
      <img style="max-height:200px;width:auto;" src="https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=Hello%20world"/>
    </center>
  </div>
  <div class="span10">
    <div style="margin-top:18px;" class="well">
      <center>
        <h1 style="line-height:50px;">Join here: <%= link_to "http://spinit.herokuapp.com" +play_path, play_path %></h1>
      </center>
    </div>
  </div>
</div>
<div class="row-fluid">
  <div class="span12">
    <div style="padding:19px;">

      <% @page.users.each do |user| %>
        <div onmouseover="$(this).tooltip('toggle');" rel="tooltip" data-original-title="<%= user.name %>" class="person user<%= user.id %>" style="background-image:url('<%= user.image %>');">
          <div style="padding-top:30px">
            <%
              status = Taker.find_by_user_id(user.id).status
              if status == 0
            %>
                <div class="ribbon-wrap yellow-ribbon pulse">waiting</div>
            <% elsif(status == 1) %>
                <div class="ribbon-wrap blue-ribbon">done</div>
            <% else %>
                <div class="ribbon-wrap green-ribbon">100%</div>
            <% end %>
          </div>
        </div>
      <% end %>

  </div>
<div>
<div class="row-fluid">
  <div class="span12">
    <div style="height:350px;" class="well" id="map"></div>
  </div>
<div>
<script type="text/javascript">

  $(function() {
    $("#map").gmap3({
      action: 'init',
      options:{
        center:[37.60315,-122.189004],
        zoom:9,
        maxZoom:17,
        disableDefaultUI:true
      }
    });
    <% @page.users.each do |user| %>
      $('#map').gmap3({
        action: 'addMarker',
        latLng:[<%= user.position.latitude %>,<%= user.position.longitude %>],
        tag:'user'+<%= user.id %>,
        options:{
          animation: google.maps.Animation.DROP/*,
          icon: new google.maps.MarkerImage(member.info.image, new google.maps.Size(20, 20), new google.maps.Point(0,0), new google.maps.Point(0, 32), new google.maps.Size(25, 25))*/
        },
        events:{
          mouseover: function(marker){
            $('.user' + <%= user.id %>).css('border', 'red solid 2px').fadeIn();
          },
          mouseout: function() {
            $('.user' + <%= user.id %>).css('border', 'none');
          }
        }
      });
    <% end %>
    $('#map').gmap3({
      action:'autofit'
    });
  }); //<--- end document ready

  var channel = pusher.subscribe('presence-<%= @page.id %>');

  channel.bind('pusher:subscription_succeeded', function(members) {
    members.each(function(member) {
      if(member.id != 0) {
        alert("subscribed!");
        //drop_marker(member);
        //add_to_people(member);
      }
    });
  });

  channel.bind('pusher:member_added', function(member) {
    alert('added!');
    $('.user' + member.id).animate({opacity:1});
    //add_to_people(member);
  });

  channel.bind('pusher:member_removed', function(member) {
    alert('removed');
    $('.user' + member.id).animate({opacity:.5});
    //remove_marker(member);
    //remove_from_people(member);
  });

  function drop_marker(member) {
    $('#map').gmap3({
      action: 'addMarker',
      latLng:[member.info.latitude,member.info.longitude],
      tag:'user'+member.id,
      options:{
        animation: google.maps.Animation.DROP/*,
        icon: new google.maps.MarkerImage(member.info.image, new google.maps.Size(20, 20), new google.maps.Point(0,0), new google.maps.Point(0, 32), new google.maps.Size(25, 25))*/
      },
      events:{
        mouseover: function(marker){
          $('.user' + member.id).css('border', 'red solid 2px').fadeIn();
        },
        mouseout: function() {
          $('.user' + member.id).css('border', 'none');
        }
      }
    },
    "autofit"
    );
  }

  function remove_marker(member) {
    $('#map').gmap3({
      action:'clear', 
      name:'marker', 
      tag:'user'+member.id
    },
    "autofit"
    ); 
  }
</script>